{% extends "base.html" %}
{% load filters %}

{% block title %}{{project_name}}: List of records{% if tag %} tagged with {{tag}}{% endif %}{% endblock %}

{% block header %}<h1><a href="about/">{{project_name}}</a>: List of records{% if tag %} tagged with <em>{{tag}}</em>{% endif %}</h1>{% endblock %}

{% block content %}

<p><a href="/">Return to list of projects</a></p>
<link rel="stylesheet" href='/media/jquery.fancybox-1.3.4.css'>
<script type = 'text/javascript' src='/media/jquery-1.6.4.min.js'></script>
<script type="text/javascript" src="/media/jquery.fancybox-1.3.4.pack.js"></script>
<div id="fancybox-loading"><div></div></div>
<script type = 'text/javascript'>
$(document).ready(function(){
    $('#but_run').click(function(){
        $.ajax({
          type: 'POST',
          url: 'simulation',
          async: true,
          success: function(){  
            window.open('http://127.0.0.1:8000/project/', "_self");
          },
        }).done(function(data) {
        })
    });
   $('#fancybox-loading').hide().ajaxStart(function() { $.fancybox.showActivity() }).ajaxStop(function() {$.fancybox.hideActivity();});
});
</script>

{% if tag %}
<p><a href="/{{project_name}}/">Return to full record list</a></p>
<p><a href="/{{project_name}}/tag/">Return to list of tags</a></p>
{% endif %}

{% if object_list %}
    <form method="POST" action="/{{project_name}}/delete/">
    <table class="simlist">
        <tr>
            <th rowspan="2"><input type="Submit" value="Delete"/><br/><small>include data&nbsp;</small><input type="checkbox" name="delete_data" value="True"/></th>
            <th rowspan="2">Label</th>
            <th rowspan="2">Reason</th>
            <th rowspan="2">Outcome</th>
            <th rowspan="2">Duration</th>
            <th rowspan="2">Processes</th>
            <th colspan="2">Executable</th>
            <th colspan="4">Script</th>
            <th rowspan="2">Date</th>
            <th rowspan="2">Time</th>
            <th rowspan="2">Tags</th>
        </tr>
        <tr>
            <th>Name</th>
            <th>Version</th>
            <th>Repository</th>
            <th>Main file</th>
            <th>Version</th>
            <th>Arguments</th>
        </tr>
        {% for record in object_list %}
        <tr class="{% cycle odd,even %}">
            <td><input type="checkbox" name="delete" value="{{record.label}}"/></td>
            <td><a href="/{{project_name}}/{{record.label|escapeslash}}/">{{record.label}}</a></td>
            <td>{{record.reason}}</td>
            <td>{{record.outcome}}</td>
            <td>{{record.duration|human_readable_duration}}</td>
            <td>{{record.launch_mode.get_parameters.n|default:"1"}}</td>
            <td>{{record.executable.name}}</td>
            <td>{{record.executable.version}}</td>
            <td>{{record.repository.url}}</td>
            <td>{{record.main_file}}</td>
            <td>{{record.version}}{% if record.diff %}*{% endif %}</td>
            <td>{{record.script_arguments}}</td>
            <td>{{record.timestamp|date:"d/m/Y"}}</td>
            <td>{{record.timestamp|date:"H:i:s"}}</td>
            {% if tag %}
            <td>{% for other_tag in record.tag_objects %}{% if tag == other_tag %}{{tag}} {% else %}<a href="/{{project_name}}/tag/{{other_tag.name}}/">{{other_tag.name}}</a> {% endif %}{% endfor %}</td>
            {% else %}
            <td>{{record.tags|link:"tag/%s/"}}</td>
            {% endif %}
        </tr>
        {% endfor %}
    </table>
    </form>
    {% if is_paginated %}
    <p>
    {% if page_obj.has_previous %}<a href="?page={{page_obj.previous_page_number}}&per_page={{records_per_page}}"><img src="/media/Go-previous.png" alt="previous page"/></a>{% else %}&nbsp;&nbsp;&nbsp;{% endif %}
    {% if page_obj.has_next %}<a href="?page={{page_obj.next_page_number}}&per_page={{records_per_page}}"><img src="/media/Go-next.png" alt="next page"/></a>{% endif %}
    Records {{page_obj.start_index}}-{{page_obj.end_index}} of {{paginator.count}}
    <form method="GET" action=".">
        <label for="per_page">Records per page: </label><input type="text" id="per_page" name="per_page" value="{{records_per_page}}" />
        <input type="submit" value="Update"/>
    </form>
    </p>
    {% endif %}
    <input type="button" value="run sumatra" id='but_run' /> 
{% else %}
    <p class="warning"><strong>No records found</strong></p>
{% endif %}

{% endblock %}
